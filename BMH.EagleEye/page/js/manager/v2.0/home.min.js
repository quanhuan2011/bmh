var bmhAdData=function(){
    return{
        changeClassify:function(){

            //按分类切换图表样式
            $('.bmhDataPic .tip').find('li').click(function(){
                $(this).addClass('on').siblings().removeClass('on');
            })
        },
        calendar:function(){
             //头部日历
            $('.dateBox').click(function(e){
                if($(this).hasClass('open')){
                    $(this).removeClass('open');
                }else{
                    $(this).addClass('open');
                }
                e.stopPropagation();
            })
            $('.dateBox input').click(function(){
                $('.dateBox').trigger('click');              
            })
            $('body').click(function(){
                $('.dateBox').removeClass('open');
            })

            //设置日历默认时间为昨天
            function GetDateStr(AddDayCount) {
                var dd = new Date();
                dd.setDate(dd.getDate()+AddDayCount);//获取AddDayCount天后的日期
                var y = dd.getFullYear();
                var m = dd.getMonth()+1;//获取当前月份的日期
                var d = dd.getDate();
                var toDouble = function(num){
                    return num = num < 10 ? '0'+num : '' + num
                }
                return toDouble(y)+"-"+toDouble(m)+"-"+toDouble(d);
            }
            //"前天："+GetDateStr(-2)
            //GetDateStr(-1);昨天
            //今天："+GetDateStr(0)
            //明天："+GetDateStr(1)
            //后天："+GetDateStr(2)
            //大后天："+GetDateStr(3)
            var date = GetDateStr(-1);
            $('.dateBox input').val(date+' 至 '+date);
        },
        choice:function(){
            //模拟select下拉效果
            var slideW = $('.bmhDataPic').find('.choice').outerWidth();
            $('.slide').width(slideW);
            $('.bmhDataPic').on('click', '.box', function(e) {
                var parent = $(this).closest('.bmhDataPic');
                if (!parent.hasClass('is-open')) {
                    $('.slide').slideDown(300);
                    parent.addClass('is-open')
                    $('.triangle').addClass('open');
                } else {
                    $('.slide').slideUp(300);
                    parent.removeClass('is-open');
                    $('.triangle').removeClass('open');
                }
                e.stopPropagation();
             })
            $('.bmhDataPic').on('click', '.slide', function(e) {
                e.stopPropagation();
            })
            //点击body隐藏
            $('html').on('click', function(e) {
                $('.slide').slideUp(300);
                $('.bmhDataPic').removeClass('is-open');
                $('.triangle').removeClass('open');
                
            });

            //select框内容动态生成
            $("input[name='apk[]']:checked").parents('dd').addClass('cur');
            $('.checkbox').on('click',function(){
                var _html="";var _txt,classN;
                if($("input[name='apk[]']:checked").length < 2){//数量少于2个时可点击多选框

                        if($(this).siblings("input[type='checkbox']").attr('checked')){//如果已选，切换为未选

                            $(this).removeClass('cur').parents('dd').removeClass('cur');
                            $(this).siblings("input[type='checkbox']").removeAttr('checked');
                            $("input[name='apk[]']:checked").each(function(){
                                 _txt = $(this).prev().val();
                                classN = $(this).parents('.checkbox-con').parent().attr('class');
                                _html += "<dd class='"+classN+"'>"+_txt+"</dd>";
                                
                            })
                            $("input[name='apk[]']").next().css('cursor','pointer').parents('dd').css('cursor','default');
                        }
                        else{//如果未选 则切换为已选
                            $(this).addClass('cur');
                            //$(this).siblings("input[type='checkbox']").attr('checked','checked');
                            var $val = $(this).prev().val();
                            $(this).siblings("input[type='checkbox']").remove();
                            $(this).before('<input type="checkbox" class="ipt-hide" name="apk[]" value="'+$val+'" checked="checked">');
                            $(this).parents('dd').addClass('cur');
                            $("input[name='apk[]']:checked").each(function(){
                                 _txt = $(this).parents('.checkbox-con').prev().text();
                                classN = $(this).parents('.checkbox-con').parent().attr('class');
                                _html += "<dd class='"+classN+"'>"+_txt+"</dd>";                               
                            })

                             $("input[name='apk[]']:not(:checked)").next().css('cursor','not-allowed').parents('dd').css('cursor','not-allowed')  
                             if($("input[name='apk[]']:checked").length<2){
                                $("input[name='apk[]']:not(:checked)").next().css('cursor','pointer').parents('dd').css('cursor','default')
                            } 
                        }
                }else{

                    //数量大于2个时，如果已选，点击切换为未选
                    if($(this).siblings("input[type='checkbox']").attr('checked')){
                            $(this).removeClass('cur').parents('dd').removeClass('cur');;
                            $(this).siblings("input[type='checkbox']").removeAttr('checked');

                            //如果点击的选中的，那么其他所有的都可点击
                            $("input[name='apk[]']").next().css('cursor','pointer').parents('dd').css('cursor','default')   

                    }else{
                            //如果点击的是未选的，那么所有的未选择的都不可点击
                            $("input[name='apk[]']:not(:checked)").next().css('cursor','not-allowed').parents('dd').css('cursor','default');
                    }
                    var a = $("input[name='apk[]']:checked").length;
                    $("input[name='apk[]']:checked").each(function(){//拼接字符串
                             _txt = $(this).parents('.checkbox-con').prev().text();
                            classN = $(this).parents('.checkbox-con').parent().attr('class');
                            _html += "<dd class='"+classN+"'>"+_txt+"</dd>";
                            
                        })

                }
                
                $('.choice .box').find('dl').html(_html) //加载              
            });

            //默认已选择2个的情况下其他未选择的不可点击
            $("input[name='apk[]']:not(:checked)").next().css('cursor','not-allowed').parents('dd').css('cursor','not-allowed')
            $('.checkbox-con').click(function(){
                event.stopPropagation();//防止冒泡
            })

        },

    }// return end
    
}()
bmhAdData.changeClassify();
bmhAdData.choice();
 bmhAdData.calendar();

 //数字增加效果
 $(function(){
    function formatter(a,b){return a.toFixed(b.decimals)}function count(a){var b=$(this);a=$.extend({},a||{},b.data("countToOptions")||{}),b.countTo(a)}$.fn.countTo=function(a){return a=a||{},$(this).each(function(){function j(){h+=d,g++,k(h),"function"==typeof b.onUpdate&&b.onUpdate.call(e,h),g>=c&&(f.removeData("countTo"),clearInterval(i.interval),h=b.to,"function"==typeof b.onComplete&&b.onComplete.call(e,h))}function k(a){var c=b.formatter.call(e,a,b);f.html(c)}var b=$.extend({},$.fn.countTo.defaults,{from:$(this).data("from"),to:$(this).data("to"),speed:$(this).data("speed"),refreshInterval:$(this).data("refresh-interval"),decimals:$(this).data("decimals")},a),c=b.speed/b.refreshInterval,d=(b.to-b.from)/c,e=this,f=$(this),g=0,h=b.from,i=f.data("countTo")||{};f.data("countTo",i),i.interval&&clearInterval(i.interval),i.interval=setInterval(j,b.refreshInterval),k(h)})},$.fn.countTo.defaults={from:0,to:0,speed:1e3,refreshInterval:100,decimals:0,formatter:formatter,onUpdate:null,onComplete:null},$(".count-title").data("countToOptions",{formatter:function(a,b){return a.toFixed(b.decimals).replace(/\B(?=(?:\d{3})+(?!\d))/g,",")}}),$(".timer").each(count);
 })

 
    

